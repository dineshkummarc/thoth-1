var PPX=function(){function c(a,b,c){if(!b.allowOrigin)return c.error("CORS is unsupported at that path."),!1;if(b.allowOrigin!="*"&&a.origin!=b.allowOrigin){c.error("message from invalid origin: "+a.origin);return}return!0}function d(a){return{allowOrigin:a.getResponseHeader("Access-Control-Allow-Origin")}}function e(a,c,d){function e(){return a.postMessage?a:a.contentWindow}function g(a){if(a.source!=e())return;var c=b.decode(a.data);"__simpleChannelError"in c?f.onError(c.__simpleChannelError,a.origin):f.onMessage(c,a.origin)}var f={onMessage:c,onError:d||function(b){window.console&&window.console.error&&window.console.error(b)},destroy:function(){b.off(window,"message",g),a=null,c=null},send:function(a){e().postMessage(b.encode(a),"*")},error:function(a){e().postMessage(b.encode({__simpleChannelError:a}),"*")}};return b.on(window,"message",g),f}var a={requestHeaders:["Accept","Content-Type"],requestMethods:["GET","POST","HEAD"],requestContentTypes:["application/x-www-form-urlencoded","multipart/form-data","text/plain"]},b={warn:function(b){window.console&&window.console.warn&&window.console.warn(b)},absolutifyURL:function(b){var c=document.createElement("a");return c.setAttribute("href",b),c.href},on:function(b,c,d){b.attachEvent?b.attachEvent("on"+c,d):b.addEventListener(c,d,!1)},off:function(b,c,d){b.detachEvent?b.detachEvent("on"+c,d):b.removeEventListener(c,d,!1)},encode:function(b){var c=[];for(var d in b)c.push(d+"="+encodeURIComponent(b[d]));return c.join("&")},decode:function(c){return b.parseUri("?"+c).queryKey},isSameOrigin:function(c,d){return c=b.parseUri(c),d=b.parseUri(d),c.protocol==d.protocol&&c.authority==d.authority},map:function(b,c){var d=[];for(var e=0;e<b.length;e++)d.push(c(b[e]));return d},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},parseUri:function(c){var d=b.parseUriOptions,e=d.parser[d.strictMode?"strict":"loose"].exec(c),f={},g=14;while(g--)f[d.key[g]]=e[g]||"";return f[d.q.name]={},f[d.key[12]].replace(d.q.parser,function(a,b,c){b&&(f[d.q.name][b]=decodeURIComponent(c))}),f},parseUriOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},inArray:function(b,c,d){var e,f=Array.prototype.indexOf;if(c){if(f)return f.call(c,b,d);e=c.length,d=d?d<0?Math.max(0,e+d):d:0;for(;d<e;d++)if(d in c&&c[d]===b)return d}return-1}};return{version:"0.1",utils:b,config:a,startServer:function(g){g=g||{};var h=g.window||window.parent,i=e(h,function(e,f){if(e.cmd=="send"){var h=new XMLHttpRequest;e.origin=f,e.headers=b.decode(e.headers);if(!b.isSameOrigin(window.location.href,e.url)){i.error("url does not have same origin: "+e.url);return}if(b.inArray(e.method,a.requestMethods)==-1){i.error("not a simple request method: "+e.method);return}h.open(e.method,e.url),h.onreadystatechange=function(){if(h.readyState==2){var a=d(h);g.modifyAccessControl&&g.modifyAccessControl(a,e);if(!c(e,a,i)){h.abort();return}}i.send({cmd:"readystatechange",readyState:h.readyState,status:h.status,statusText:h.statusText,responseText:h.responseText,responseHeaders:h.getAllResponseHeaders()})};var j=e.headers["Content-Type"];if(j&&b.inArray(j,a.requestContentTypes)==-1){i.error("invalid content type for a simple request: "+j);return}for(var k in e.headers)if(b.inArray(k,a.requestHeaders)==-1){if(k!="X-Requested-With"){i.error("header '"+k+"' is not allowed.");return}}else h.setRequestHeader(k,e.headers[k]);h.setRequestHeader("X-Original-Origin",e.origin),h.send(e.body||null)}});i.send({cmd:"ready"})},buildClientConstructor:function(c){return function(){function k(){g&&(g.destroy(),g=null),h&&(document.body.removeChild(h),h=null)}var d,f,g,h,i={},j="",l={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,readyState:0,status:0,statusText:"",responseText:"",open:function(a,b){d=a,f=b,l.readyState=l.OPENED,l.onreadystatechange&&l.onreadystatechange()},setRequestHeader:function(a,b){i[a]=b},getAllResponseHeaders:function(){return j},abort:function(){h&&(k(),l.readyState=l.DONE,l.onreadystatechange&&l.onreadystatechange(),l.readyState=l.UNSENT)},send:function(a){if(l.readyState==l.UNSENT)throw new Error("request not initialized");h=document.createElement("iframe"),g=e(h,function(c){switch(c.cmd){case"ready":g.send({cmd:"send",method:d,url:b.absolutifyURL(f),headers:b.encode(i),body:a||""});break;case"readystatechange":l.readyState=parseInt(c.readyState),l.status=parseInt(c.status),l.statusText=c.statusText,l.responseText=c.responseText,j=c.responseHeaders,l.readyState==4&&k(),l.onreadystatechange&&l.onreadystatechange()}},function(c){b.warn(c),l.responseText=c,l.readyState=l.DONE,k(),l.onreadystatechange&&l.onreadystatechange()}),h.setAttribute("src",b.absolutifyURL(c)),h.style.display="none",document.body.appendChild(h)}};return l}}}}();(function(a){a.extend({proxyAjaxThroughPostMessage:function(b){var c=PPX.buildClientConstructor(b),d=PPX.utils;b=d.absolutifyURL(b),a.ajaxPrefilter(function(e,f,g){(e.crossDomain&&!a.support.cors||e.usePostMessage)&&d.isSameOrigin(b,d.absolutifyURL(e.url))&&(e.xhr=c,e.crossDomain=!1,g.isProxiedThroughPostMessage=!0)})}})})(jQuery),thoth=function(){var a={},b="http://eirikb.no:3000/";return a.read=function(a,c){$.get(b+"read/"+a,c)},a.create=function(a,c,d){arguments.length<3&&(d=c,c=a,a=""),arguments.length===3&&(a="/"+a),$.post(b+"create"+a,{data:c},d)},a}();